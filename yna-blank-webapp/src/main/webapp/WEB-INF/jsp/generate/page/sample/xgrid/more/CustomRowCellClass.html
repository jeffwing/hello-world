<style type="text/css" scoped>
	.vue-form.escort-vue.escort-vue-form {
		padding: 8px;
	}

	.tip .vue-note__description {
		font-size: 14px;
		color: black;
	}

	.row-green {
		background-color: green;
	}

	.red {
		color: red;
	}

	.col-red {
		background-color: red;
		color: #607D8B;
	}

	.col-orange {
		background-color: #f60;
		color: #607D8B;
	}

	.vue-xtable-table .vue-xtable-body--row.row-green {
		background-color: #67c23a;
	}

	.vue-xtable-table .vue-xtable-body--row.row-blue {
		background-color: #00bcd4;
	}

	.col-blue {
		background-color: #2db7f5;
		color: #607D8B;
	}

	.button-cls {
		padding-top: 10px;
		padding-left: 10px;
	}
</style>
<template>
	<div v-cloak class="page" v-loading="pageLoading" :vue-loading-text="messageutil.get('page.loading.text')">
		<escort-form ref="form" id="form" :model="form">
			<escort-notice :show-content="true" cls="tip" title=" " id="vueNotice_HrG4D" ref="vueNotice_HrG4D"> 行的样式、单元格样式可以通过Row Class Name、Cell Class Name自定义<br><span class="red"> （注：当自定义样式之后可能会覆盖表格的样式，比如选中行、斑马纹...等，记得自行处理好相关样式）</span>
			</escort-notice>
			<escort-xgrid :lazyload="false" :stripe="true" :front-pagination="true" :remote-sort="false" :row-draggable="false" :column-draggable="false" :pageable="true" :height="gridHeight" :border="true" :highlight-current-row="true" empty-text="No Data..." id="vueXgrid" ref="vueXgrid" :data="grid.data" data-field="datas" :datasource="grid" total-field="total" :cell-class-name="vueXgridCellClassName" :row-class-name="vueXgridRowClassName" :rules="vueXgridRules" :toolbar="{ id:'vueXgridToolbar' ,refresh: true ,setting: true }">
				<escort-xgrid-column type="index" align="center" width="50px" min-width="50px">
				</escort-xgrid-column>
				<escort-xgrid-column prop="userName" edit-render-default-value="测试员" :rowspan="true" text="用户名" width="100px" render-name="input">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="numeric" :edit-render-attrs-cleave="vueXgridAgeCleave" prop="age" align="right" aggregate="average" aggregate-label="平均年龄：" :edit-render-default-value="20" text="年龄" width="100px">
				</escort-xgrid-column>
				<escort-xgrid-column prop="useStatus" align="center" edit-render-default-value="true" text="状态" header-align="center" width="100px" render-name="switch" display-style="switch" :template="true" edit-render-attrs-on-text="正常" edit-render-attrs-off-text="禁用" edit-render-attrs-on-color="red" edit-render-attrs-off-color="green">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="useStatus" widget-type="switch" on-text="正常" off-text="禁用" align="center">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" render-name="radio" prop="sexValue" edit-render-attrs-display-member="key" edit-render-attrs-value-member="value" align="center" text="性别" width="80px" :edit-render-attrs-options="radioSet.data" :edit-render-attrs-datasource="radioSet">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="sexValue" widget-type="radio" display-member="key" value-member="value" align="center" :options="radioSet.data">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="month" prop="datemonth" align="center" edit-render-value-format="yyyyMMdd" show-overflow="tooltip" text="年月" width="100px" format="yyyy-MM">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="date" prop="date" align="center" edit-render-value-format="yyyyMMdd" show-overflow="tooltip" text="日期" width="110px" format="ymd">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="select" :template="true" :edit-render-attrs-options="selectSet.data" :edit-render-attrs-datasource="selectSet" edit-render-attrs-display-member="key" prop="department" align="center" text="部门" width="100px">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="department" widget-type="select" display-member="key" align="center" :options="selectSet.data">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column render-name="textarea" prop="address" text="地址" min-width="200px">
				</escort-xgrid-column>
			</escort-xgrid>
		</escort-form>
	</div>
</template>
<script type="text/javascript">
	var pageMixins;
	(function() {
		var pageMixinMap = {};
		pageMixinMap.event = {
			methods: {
				vueXgridCellClassName: function(obj) {
					var row = obj.row;
					var column = obj.column;
					if (column.property === 'age') {
						if (row.sexValue == '0') {
							return 'col-blue'
						} else if (row.age > 46) {
							return 'col-orange'
						}
					}
				},
				vueXgridRowClassName: function(obj) {
					if ([2, 3, 5].includes(obj.rowIndex)) {
						return 'row-green';
					}
				}
			}
		};
		pageMixinMap.manualSeperate = {
			data: function() {
				return {
					gridHeight: 0
				};
			},
			created: function() {
				var thiz = this;
				window.onresize = function() {
					thiz.autoSetGridHeight();
				};
			},
			mounted: function() {
				this.autoSetGridHeight();
				window['xgrid'] = this;
			},
			methods: {
				autoSetGridHeight: function() {
					var winHeight = 0;
					if (window.innerHeight) {
						winHeight = window.innerHeight;
					} else if ((document.body) && (document.body.offsetHeight)) {
						winHeight = document.body.offsetHeight;
					}
					if (document.documentElement && document.documentElement.offsetHeight) {
						winHeight = document.documentElement.offsetHeight;
					}
					var vueNoticeHeight = this.getRef('vueNotice_HrG4D').$el.offsetHeight;
					var frameHeight = 0; //Compatible height calculation of page and page template
					if (document.getElementsByClassName('navbar').length > 0) {
						frameHeight += document.getElementsByClassName('navbar')[0].offsetHeight;
					}
					if (document.getElementsByClassName('tags-view-container').length > 0) {
						frameHeight += document.getElementsByClassName('tags-view-container')[0].offsetHeight;
					}
					this.gridHeight = winHeight - vueNoticeHeight - frameHeight - 16;
				},
				deleteRow: function(row) {
					var self = this;
					var escortGrid = self.$refs.vueXgrid;
					self.$confirm({
						title: "确认",
						message: "确认删除?",
						type: "warning"
					}).then(function(action) {
						escortGrid.removeRows([row]);
					}).catch(function(action) {
						console.error(action);
					});
				}
			}
		};
		pageMixinMap.auto = {
			data: function() {
				return {
					pageLoading: false,
					form: {},
					vueXgridRules: {
						address: [{
							required: true,
							message: 'age must be filled in'
						}]
					},
					vueXgridAgeCleave: {
						numeralDecimalScale: '0'
					},
					grid: this.getDataSource({
						url: "/xgrid/search.json",
						type: "POST"
					}),
					selectSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "",
							key: ""
						}, {
							value: "RD",
							key: "研发部"
						}, {
							value: "SD",
							key: "销售部"
						}, {
							value: "AD",
							key: "管理部"
						}]
					}),
					radioSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "",
							key: "未知"
						}, {
							value: "1",
							key: "男"
						}, {
							value: "0",
							key: "女"
						}]
					}),
					checkboxSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "01",
							label: "看书"
						}, {
							value: "02",
							label: "游戏"
						}, {
							value: "03",
							label: "篮球"
						}, {
							value: "04",
							label: "旅游"
						}, {
							value: "05",
							label: "电影"
						}]
					})
				};
			},
			mounted: function() {
				this.grid.retrieve();
				this.selectSet.retrieve();
				this.radioSet.retrieve();
				this.checkboxSet.retrieve();
			}
		};
		pageMixins = getPageMixins(pageMixinMap);
	})();
	module.exports = {
		mixins: pageMixins,
		name: "CustomRowCellClass"
	};
</script>