<style type="text/css" scoped>
	.single-group-header .hide-col {
		display: none;
	}

	.single-group-header .display-col {
		width: 100% !important;
	}
</style>
<template>
	<div v-cloak class="page" v-loading="pageLoading" :vue-loading-text="messageutil.get('page.loading.text')">
		<escort-form ref="form" id="form" :model="form">
			<escort-xgrid :lazyload="false" :stripe="true" :front-pagination="true" :remote-sort="false" :row-draggable="false" :column-draggable="false" :page-sizes="[10, 20, 30, 40, 150, 200]" :pageable="true" :height="gridHeight" :border="true" :highlight-current-row="true" empty-text="No Data..." id="vueXgrid" ref="vueXgrid" @cell-click="vueXgridCellClick" :data="grid.data" data-field="datas" :datasource="grid" total-field="total" :rules="vueXgridRules" :mouse-config="{ selected: true }" :toolbar="{ id:'vueXgridToolbar' ,refresh: true ,setting: true }">
				<escort-xgrid-column align="center" type="checkbox" width="50px">
				</escort-xgrid-column>
				<escort-xgrid-column type="index" align="center" width="50px" min-width="50px">
				</escort-xgrid-column>
				<escort-xgrid-column prop="['userName','age']" header-class-name="single-group-header" width="200px" text="用户信息" id="vueXgridGroupColumn_Dlg1h" ref="vueXgridGroupColumn_Dlg1h" render-name="common" :template-column="true">
					<escort-xgrid-column prop="userName" edit-render-default-value="测试员" :rowspan="true" text="用户名" width="100px" render-name="input">
					</escort-xgrid-column>
					<escort-xgrid-column render-name="numeric" :edit-render-attrs-decimal-scale="0" prop="age" align="right" aggregate="average" aggregate-label="平均年龄：" :edit-render-default-value="20" text="年龄" width="100px">
					</escort-xgrid-column>
				</escort-xgrid-column>
				<escort-xgrid-column render-name="numeric" :edit-render-attrs-cleave="vueXgridSalaryCleave" prop="salary" align="right" aggregate="average" aggregate-label="平均年龄：" :sortable="true" :edit-render-default-value="20" text="月薪" width="100px">
				</escort-xgrid-column>
				<escort-xgrid-column prop="useStatus" align="center" edit-render-default-value="true" text="状态" header-align="center" width="100px" render-name="switch" display-style="switch" :template="true" edit-render-attrs-on-text="正常" edit-render-attrs-off-text="禁用" edit-render-attrs-on-color="red" edit-render-attrs-off-color="green">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="useStatus" widget-type="switch" on-text="正常" off-text="禁用" align="center">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" render-name="radio" prop="sexValue" edit-render-attrs-display-member="key" edit-render-attrs-value-member="value" align="center" text="性别" width="80px" :edit-render-attrs-options="radioSet.data" :edit-render-attrs-datasource="radioSet">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="sexValue" widget-type="radio" display-member="key" value-member="value" align="center" :options="radioSet.data">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="month" prop="datemonth" align="center" edit-render-value-format="yyyyMMdd" show-overflow="tooltip" text="年月" width="100px" format="yyyy-MM">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="date" prop="date" align="center" edit-render-value-format="yyyyMMdd" show-overflow="tooltip" text="日期" width="110px" format="ymd">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="daterange" prop="daterange" align="center" edit-render-value-format="yyyyMMdd" show-overflow="tooltip" text="日期区间" width="200px" format="ymd">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="datetime" prop="datetime" align="center" edit-render-value-format="yyyy-MM-dd HH:mm:ss" show-overflow="tooltip" text="日期时间" width="160px" format="ymdt">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="date" edit-render-attrs-type="time" prop="time" align="center" edit-render-value-format="HH:mm:ss" show-overflow="tooltip" text="时间" width="120px" format="hms">
				</escort-xgrid-column>
				<escort-xgrid-column render-name="select" :template="true" :edit-render-attrs-options="selectSet.data" :edit-render-attrs-datasource="selectSet" edit-render-attrs-display-member="key" prop="department" align="center" text="部门" width="100px">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="department" widget-type="select" display-member="key" align="center" :options="selectSet.data">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" prop="userLink" text="链接网址" width="150px">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="userLink" widget-type="link" display-type="Text" link-target="_blank">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" align="center" text="窗口链接" width="150px">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="" widget-type="link" align="center" display-type="Button" button-label="打开" button-size="small" @click="vueXgridClickMethod">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" align="center" text="Tab链接" width="150px">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="" widget-type="link" align="center" display-type="Button" button-label="打开" button-size="small" @click="vueXgridClickMethod">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" render-name='img' prop="img" :sortable="false" text="照片" width="80px">
					<template slot="default" slot-scope="scope">
						<escort-img :sortable="false" :preview-src-list="scope.row.img" fit="fill" :src="scope.row.img" :style_="{height:'30px',width:'50px'}">
						</escort-img>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column :template="true" render-name="checkbox" prop="interest" edit-render-attrs-display-member="label" edit-render-attrs-value-member="value" show-overflow="ellipsis" text="爱好" width="200px" :edit-render-attrs-options="checkboxSet.data" :edit-render-attrs-datasource="checkboxSet">
					<template slot="default" slot-scope="scope">
						<escort-xgrid-column-display :row="scope.row" field="interest" widget-type="checkbox" display-member="label" value-member="value" :options="checkboxSet.data">
						</escort-xgrid-column-display>
					</template>
				</escort-xgrid-column>
				<escort-xgrid-column render-name="textarea" prop="address" text="地址" min-width="200px">
				</escort-xgrid-column>
				<escort-xgrid-column :border="true" fixed="right" text="template" width="150px" type="common" :template-header="true" :template="true" render-name="template">
					<template slot="header" slot-scope="scope"> 操作 </template>
					<template slot="default" slot-scope="scope">
						<vue-row>
							<vue-col :span="12">
								<vue-button size="small" type="primary" @click="deleteRow(scope.row)">删除</vue-button>
							</vue-col>
							<vue-col :span="12">
								<vue-upload>
									<vue-button size="small" type="primary">上传附件</vue-button>
								</vue-upload>
							</vue-col>
						</vue-row>
					</template>
				</escort-xgrid-column>
			</escort-xgrid>
			<escort-aside :src="asideSrc" :close-on-click-modal="true" id="detailAside" ref="detailAside" :iframe="true" method="get">
			</escort-aside>
		</escort-form>
	</div>
</template>
<script type="text/javascript">
	var pageMixins;
	(function() {
		var pageMixinMap = {};
		pageMixinMap.event = {
			methods: {
				vueXgridCellClick: function(obj, event) {
					debugger
				},
				vueXgridClickMethod: function(row) {
					this.openUrlAside(row);
				},
				vueXgridClickMethod: function(row) {
					this.openUrlTag(row);
				}
			}
		};
		pageMixinMap.manualCommon = [{
			beforeDestroy: function() {
				VueUtil.removeResizeListener(document.body, this.autoSetGridHeight);
			}
		}];
		pageMixinMap.manualSeperate = {
			data: function() {
				return {
					gridHeight: 0,
					asideSrc: ''
				};
			},
			mounted: function() {
				this.autoSetGridHeight();
				// 记得释放该监听器，防止内存泄漏（比如在 beforeDestroy 或 destroyed 中释放）
				VueUtil.addResizeListener(document.body, this.autoSetGridHeight);
			},
			methods: {
				openUrlTag: function(editRow) {
					var addTag = {
						code: editRow.userLink,
						url: editRow.userLink,
						type: "iframe",
						title: editRow.userLink,
						breadcrumb: editRow.userLink
					};
					router.addRoutes([{
						path: '/' + addTag.code,
						name: addTag.code,
						component: addTag.type === undefined ? VueLoader(addTag.url) : Layout,
						meta: {
							dynamic: true,
							noCache: false,
							title: addTag.title,
							type: addTag.type,
							url: addTag.type === undefined ? undefined : addTag.url,
							breadcrumb: addTag.breadcrumb
						}
					}]);
					router.push('/' + addTag.code);
				},
				openUrlAside: function(editRow) {
					this.asideSrc = editRow.userLink;
					this.$refs.detailAside.open();
				},
				autoSetGridHeight: function() {
					var winHeight = 0;
					if (window.innerHeight) {
						winHeight = window.innerHeight;
					} else if ((document.body) && (document.body.offsetHeight)) {
						winHeight = document.body.offsetHeight;
					}
					if (document.documentElement && document.documentElement.offsetHeight) {
						winHeight = document.documentElement.offsetHeight;
					}
					var frameHeight = 0; //Compatible height calculation of page and page template
					if (document.getElementsByClassName('navbar').length > 0) {
						frameHeight += document.getElementsByClassName('navbar')[0].offsetHeight;
					}
					if (document.getElementsByClassName('tags-view-container').length > 0) {
						frameHeight += document.getElementsByClassName('tags-view-container')[0].offsetHeight;
					}
					this.gridHeight = winHeight - frameHeight - 16;
				},
				deleteRow: function(row) {
					var self = this;
					var escortGrid = self.$refs.vueXgrid;
					self.$confirm({
						title: "确认",
						message: "确认删除?",
						type: "warning"
					}).then(function(action) {
						escortGrid.removeRows([row]);
					}).catch(function(action) {
						console.error(action)
					});
				}
			}
		};
		pageMixinMap.auto = {
			data: function() {
				return {
					pageLoading: false,
					form: {},
					vueXgridRules: {
						address: [{
							required: true,
							message: 'age must be filled in'
						}]
					},
					vueXgridSalaryCleave: {
						numeralDecimalScale: '2'
					},
					grid: this.getDataSource({
						url: "/xgrid/search.json",
						type: "POST"
					}),
					selectSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "",
							key: ""
						}, {
							value: "RD",
							key: "研发部"
						}, {
							value: "SD",
							key: "销售部"
						}, {
							value: "AD",
							key: "管理部"
						}]
					}),
					radioSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "",
							key: "未知"
						}, {
							value: "1",
							key: "男"
						}, {
							value: "0",
							key: "女"
						}]
					}),
					checkboxSet: this.getDataSource({
						type: "POST",
						localData: [{
							value: "01",
							label: "看书"
						}, {
							value: "02",
							label: "游戏"
						}, {
							value: "03",
							label: "篮球"
						}, {
							value: "04",
							label: "旅游"
						}, {
							value: "05",
							label: "电影"
						}]
					})
				};
			},
			mounted: function() {
				this.grid.retrieve();
				this.selectSet.retrieve();
				this.radioSet.retrieve();
				this.checkboxSet.retrieve();
			}
		};
		pageMixins = getPageMixins(pageMixinMap);
	})();
	module.exports = {
		mixins: pageMixins,
		name: "baseXgridSample"
	};
</script>